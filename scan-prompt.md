# Repo 扫描任务 Prompt（给外部 AI 使用）

> 本文件用于指导外部 AI（Grok / GPT / Gemini 等）扫描代码库并生成标准化的分析报告。
> 生成的文件将被 Claude 的 Architect Agent 直接读取，跳过重复扫描，节省 token。

---

## 你的任务

请分析我提供的代码仓库，生成一份名为 `repo-scan-result.md` 的代码库分析报告。

**我会提供给你：**
- 仓库中所有源代码文件的内容（或关键文件）
- 一份参考模板（`repo-scan-result.md` 示例）

**你需要输出：**
- 一个完整的 `repo-scan-result.md` 文件，严格遵循下方的格式规范

---

## 输出格式规范（必须严格遵守）

### 硬性约束

1. **总字符数控制在 4500 字符以内**（含标题和空行）
   - 原因：Architect 会读取前 5000 字符，超出部分会被丢弃
   - 关键信息必须放在文件前半部分
   - 优先级：快速索引 > 接口定义 > 项目结构 > 其他章节
2. **使用 Markdown 格式**
3. **文件名必须为 `repo-scan-result.md`**，放在项目根目录
4. **使用 UTF-8 编码**

### 必须包含的章节（按此顺序，优先级递减）

```markdown
# Repo Scan Result

## 🔍 快速索引（Quick Index）
（最重要！帮助 Architect 快速定位关键代码）
（格式：`类名/函数名` @ `文件路径:起始行-结束行` — 一句话说明）
（不超过 15 行，只列最核心的类和函数）

示例：
- `TaskParser` @ `src/main.py:45-120` — 解析用户输入，评估复杂度
- `execute()` @ `src/main.py:200-350` — 主执行流程
- `_handle_error()` @ `src/main.py:800-850` — 错误处理逻辑

## 📋 核心接口定义（API Interfaces）
（关键类的公共方法签名，帮助理解如何调用）
（格式：`类名.方法名(参数) -> 返回类型` — 用途）
（不超过 20 行）

示例：
- `TaskParser.parse(user_input: str) -> TaskComplexity` — 评估任务复杂度
- `Orchestrator.execute(request: str, clean_start: bool) -> bool` — 执行任务
- `AgentExecutor.run_agent(name: str, prompt: str) -> AgentResult` — 运行单个 Agent

## 🔁 常见模式（Common Patterns）
（项目中反复出现的代码模式，帮助快速编写新代码）
（不超过 10 行）

示例：
- **Git 操作模式**: `git checkout -b <branch>` → 执行操作 → `git merge` → 清理子分支
- **Agent 调用模式**: 生成 prompt → `subprocess.run(['claude', '--agent', name])` → 解析输出
- **错误处理模式**: try/except → 重试3次（指数退避） → 记录到 error_log.json

## 🛠️ 技术栈
（语言、框架、测试工具、构建工具，用列表形式，不超过 8 行）

## 📁 项目结构
（目录树，只列核心目录和关键文件，不超过 20 行）
（每个目录/文件后用简短注释说明用途）

## 🧩 核心模块
（列出主要的类/函数/模块，说明职责，不超过 15 行）
（格式：`文件路径:类名/函数名` — 一句话说明）

## 🏗️ 代码风格与架构模式
（命名规范、架构模式、设计模式，不超过 5 行）

## 🔗 依赖关系
（模块间的调用/导入关系，不超过 8 行）
（格式：`模块A` → `模块B`（原因））

## 💼 关键业务逻辑
（用 3-5 句话总结项目做什么、核心流程是怎样的）
```

### 禁止包含

- ❌ 不要包含具体代码片段（只需要行号索引和方法签名）
- ❌ 不要包含安装教程或使用说明
- ❌ 不要包含 git 历史记录
- ❌ 不要添加"建议"或"改进方向"等主观内容
- ❌ 不要包含 `.git/`、`node_modules/`、`__pycache__/` 等非源码目录
- ❌ 不要包含测试代码的详细分析（只需列出测试文件名）
- ❌ 不要解释为什么某个设计是好的或坏的，只陈述事实

---

## 质量标准（Checklist）

生成后请自检：

- [ ] 总字符数 < 4500（最重要！使用 `wc -c repo-scan-result.md` 检查）
- [ ] 包含全部 9 个必需章节（新增：快速索引、接口定义、常见模式）
- [ ] **快速索引**包含行号范围（格式：`类名 @ 文件:起始行-结束行`）
- [ ] **接口定义**包含方法签名和参数类型
- [ ] **常见模式**描述了项目中反复使用的代码模式
- [ ] 章节顺序正确（快速索引优先级最高，放在最前面）
- [ ] 项目结构使用树形格式，带注释
- [ ] 核心模块使用 `文件:名称 — 说明` 格式
- [ ] 没有包含代码片段（只有方法签名和行号）
- [ ] 没有主观建议或评价
- [ ] 信息准确、无编造（行号必须准确！）

---

## 使用方法

1. 将本 prompt 和项目源码一起提供给外部 AI
2. 可附上 `repo-scan-result.md` 模板作为参考
3. 外部 AI 生成 `repo-scan-result.md` 后，放到项目根目录
4. 运行 `6-agents.py` 时，Architect 会自动检测并读取该文件，跳过代码库扫描

---

## 何时需要重新生成

以下情况需要重新扫描：
- 新增/删除了核心模块或类
- 技术栈发生变化（新增框架、更换数据库等）
- 项目结构大幅调整（目录重命名、文件迁移）

以下情况**不需要**重新扫描：
- Bug 修复（函数内部逻辑变更）
- 新增测试用例
- 文档更新
- 配置微调
